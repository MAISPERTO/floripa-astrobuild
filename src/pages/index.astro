---
// src/pages/index.astro (VERSÃƒO FINAL COM LOGO, TAGLINE E CONTEÃšDO RESTAURADO)
import client from '../lib/directus';
import { readItems } from '@directus/sdk';
import MainLayout from '../layouts/MainLayout.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';

// 1. VariÃ¡veis de ambiente
const CITY_SLUG = import.meta.env.PUBLIC_CITY_SLUG || "floripa";Â 
const CITY_NAME = import.meta.env.PUBLIC_CITY_NAME || "FlorianÃ³polis";
const SITE_SLUG_CAPITALIZED = CITY_SLUG.charAt(0).toUpperCase() + CITY_SLUG.slice(1);
const SITE_NAME = `${SITE_SLUG_CAPITALIZED}.MP`; // Ex: Floripa.MP
const SITE_TAGLINE = "NegÃ³cios Locais"; // Tagline

// 2. Busca o ID da cidade
const cidade = await client.request(
Â  Â  readItems('mp_cidades', {
Â  Â  Â  filter: { slug_cidade: { _eq: CITY_SLUG } },
Â  Â  Â  fields: ['id'],
Â  Â  Â  limit: 1,
Â  Â  })
);
const CIDADE_ID = cidade[0]?.id;

if (!CIDADE_ID) {
Â  console.error(`CIDADE_ID para ${CITY_SLUG} nÃ£o encontrado no Directus.`);
}

// 3. Carrega bairros
const bairros = await client.request(
Â  readItems('mp_bairros', {
Â  Â  filter: {
Â  Â  Â  Â  ativo: { _eq: true },
Â  Â  Â  Â  cidade_relacionada: { _eq: CIDADE_ID }
Â  Â  },
Â  Â  fields: ['id', 'nome_bairro', 'slug_bairro'],
Â  Â  sort: ['nome_bairro'],
Â  Â  limit: -1,
Â  })
);

// 4. Carrega categorias
const categorias = await client.request(
Â  readItems('mp_categorias_locais', {
Â  Â  filter: {
Â  Â  Â  Â  ativo: { _eq: true },
Â  Â  },
Â  Â  fields: ['id', 'nome_nicho', 'full_slug_nicho'],
Â  Â  sort: ['nome_nicho'],
Â  Â  limit: -1,
Â  })
);

// 5. Propriedades e Breadcrumbs
const title = `${CITY_NAME} â€¢ ${SITE_TAGLINE} ${SITE_NAME}`;
const description = `Descubra ${SITE_TAGLINE.toLowerCase()}, serviÃ§os e profissionais em ${CITY_NAME}. Navegue por bairros e nichos para encontrar exatamente o que precisa em ${CITY_NAME}.`;
const breadcrumbs = [{ label: CITY_NAME, href: null }];
---

<MainLayout 
    title={title} 
    description={description} 
    adsenseClient="ca-pub-3803893738575618"
    siteName={SITE_NAME}
    siteTagline={SITE_TAGLINE} 
>
Â  Â  <header style="margin-bottom: 1.5rem;">
Â  Â  Â  Â  <Breadcrumbs crumbs={breadcrumbs} />
Â  Â  Â  Â  {/* ðŸ”´ O termo "NegÃ³cios Locais" foi movido para a tagline da logo no MainLayout */}
Â  Â  Â  Â  <h1 style="margin: 0 0 0.5rem 0; font-size: 1.8rem;">
Â  Â  Â  Â  Â  Â  Encontre {SITE_TAGLINE.toLowerCase()} por bairro e nicho em {CITY_NAME}
Â  Â  Â  Â  </h1>
Â  Â  Â  Â  <p style="margin: 0; color: #555;">
Â  Â  Â  Â  Â  Â  VersÃ£o inicial de testes conectada ao Directus.
Â  Â  Â  Â  </p>
Â  Â  </header>

Â  Â  {/* ðŸŸ¢ CONTEÃšDO RESTAURADO: LISTA DE BAIRROS */}
Â  Â  <section style="margin-bottom: 2rem;">
Â  Â  Â  Â  <h2 style="font-size: 1.2rem; margin-bottom: 0.75rem;">
Â  Â  Â  Â  Â  Â  Bairros cadastrados em {CITY_NAME}
Â  Â  Â  Â  </h2>
Â  Â  Â  Â  <ul style="list-style:none; padding:0; margin:0; display:flex; flex-wrap:wrap; gap:0.4rem;">
Â  Â  Â  Â  Â  Â  {bairros.map((b) => (
Â  Â  Â  Â  Â  Â  Â  Â  <li style="background:#fff; border-radius:999px; border:1px solid #ddd; padding:0.25rem 0.75rem; font-size:0.85rem;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {b.nome_bairro}
Â  Â  Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  </ul>
Â  Â  </section>

Â  Â  {/* ðŸŸ¢ CONTEÃšDO RESTAURADO: LISTA DE CATEGORIAS */}
Â  Â  <section style="margin-bottom: 2rem;">
Â  Â  Â  Â  <h2 style="font-size: 1.2rem; margin-bottom: 0.75rem;">
Â  Â  Â  Â  Â  Â  Categorias locais (navegue por nichos)
Â  Â  Â  Â  </h2>
Â  Â  Â  Â  <ul style="list-style:none; padding:0; margin:0; display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr)); gap:0.75rem;">
Â  Â  Â  Â  Â  Â  {categorias.map((cat) => (
Â  Â  Â  Â  Â  Â  Â  Â  <li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <article style="background:#fff; border-radius:0.75rem; border:1px solid #ddd; padding:0.75rem 1rem;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 style="margin:0 0 0.25rem 0; font-size:1.05rem;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href={`/${cat.full_slug_nicho}`} style="color:#005bbb; text-decoration:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {cat.nome_nicho}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin:0; font-size:0.85rem; color:#666;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  URL base: <code>{`/${cat.full_slug_nicho}`}</code>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </article>
Â  Â  Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  </ul>
Â  Â  </section>

Â  Â  <footer style="font-size: 0.8rem; color: #888;">
Â  Â  Â  Â  <p style="margin: 0;">
Â  Â  Â  Â  Â  Â  Dados filtrados para **{CITY_NAME}** ({CITY_SLUG}).
Â  Â  Â  Â  </p>
Â  Â  </footer>
</MainLayout>